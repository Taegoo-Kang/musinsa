# 무신사 POINT-API

---
## 사용 기술
- Java 17
- Spring Boot 3.0.4
- Gradle 7.6.1
- H2 DB
- JPA
- QueryDSL
### Test
- Junit 5

---
## 실행
- run> PointApiApplication
- Swagger: http://localhost:8080/swagger-ui/index.htm
- H2-Console: http://localhost:8080/h2-console


---
## 설계 방향
1. 무료포인트/유료포인트 구분.
2. 적립 테이블과 사용 테이블을 구분해서 저장한다.
3. 최대한 UPDATE는 자제한다. 원본 데이터는 유지.
4. 포인트 적립 시 적립 테이블의 적립금액, 잔여금액 저장.
5. 포인트 사용 시 적립 테이블의 잔여금액 update. 포인트 사용 테이블 저장
6. 포인트 사용 취소 시 사용 테이블의 취소 금액 update.
7. 포인트 소멸 시 적립 테이블의 소멸금액 update.
8. 모든 이벤트(적립/사용/사용취소/소멸)는 히스토리 테이블에 저장한다.
9. 포인트 사용/사용취소는 DB 직접 접근.
10. 포인트 적립/사용취소/소멸 및 포인트 잔액 테이블 update는 MQ 사용. (MQ 미구현)

---

## 요구사항 구현 여부 및 방법
1. 회원의 잔여 포인트를 조회하는 API - O
   - 회원ID로 무료 포인트, 유료 포인트, 총 포인트 조회
2. 회원의 포인트 적립/사용 내역을 조회하는 API - O
   - 전체(적립/사용), 적립만, 소멸만 조회 가능 - 페이지 사이즈 default 20
   - 사용 취소된 내역은 적립 내역에서 사용 취소된 만큼 금액 차감됨. (전체 취소된 경우에는 목록에서 제거)
3. 회원의 포인트를 적립하는 API - O
   - 포인트 타입의 적립률로 포인트금액 계산해서 저장. (0원 이하인 경우 미적립)
   - 유효기간은 포인트 타입에 설정되어 있음. (기본값 365일)
4. 회원의 포인트를 사용하는 API - O
   - 총 잔여포인트를 초과한 금액은 사용 할 수 없음
   - 유효기간이 지난 포인트는 아직 소멸되기 전이라 잔액이 남아있는 경우여도 사용 할 수 없음.
5. 회원의 포인트 사용을 취소하는 API - O
   - 사용 취소한 금액만큼 재적립

---
## 검증 방법 및 결과
1. 회원 잔여 포인트 및 적립/사용 내역 조회
   - 초기 세팅된 데이터로 조회 가능 (memberId : 10001, 10002)
2. 회원의 포인트 적립
   - 구매데이터 확정 및 적립 API로 적립 가능 (구매 데이터- memberId: 10003, orderNo: 1000009 => 163P 적립)
3. 회원의 포인트 사용
   - memberId: 10001, orderNo: 100020, useAt: 10000 => 무료포인트 1000, 유료포인트 6038 사용. 잔여 포인트 17038 -> 7038로 차감.
   - 주문번호 필수: 포인트 사용 취소 시 사용
4. 회원의 포인트 사용 취소
   - memberId: 10002, orderNo: 1000010, useAt: 3000 => 무료포인트 3000 증감.
